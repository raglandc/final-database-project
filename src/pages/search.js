import { useSession } from 'next-auth/react';

import Layout from '@/components/Layout'
import SideBar from '@/components/SideBar'
import MovieBar from '@/components/MovieBar';
import Head from 'next/head'
import prisma from '../../lib/prisma';

export default function Search({movies}) {
  const { data : session } = useSession();

  if (session) {
    return (
      <>
        <Head>
          <title>Create Next App</title>
          <meta name="description" content="Generated by create next app" />
          <meta name="viewport" content="width=device-width, initial-scale=1" />
          <link rel="icon" href="/favicon.ico" />
        </Head>
        <Layout>
          <main className='grid grid-cols-12 gap-4 min-h-screen'>
            <aside className='col-span-3 h-full bg-teal-800'>
              <SideBar/>
            </aside>
            <section className='col-start-4 col-end-13'>
              <div>
                {movies.map((movie) => {
                  return <MovieBar 
                          key={movie.MoviesID} 
                          title={movie.M_title}
                          overview={movie.M_overview}
                          rating={movie.m_voteAvg}
                          />
                })}
              </div>
            </section>
          </main>
        </Layout>
      </>
    )
  }
  else 
  {
    return <p>No user signed in</p>
  }
}

export async function getServerSideProps()
{
  const movies = await prisma.movies.findMany({
    where: {
      MoviesID: {lte: 4}
    }
  });
  return {
    props: { 
      movies: JSON.parse(JSON.stringify(movies)), 
    }
  }
}